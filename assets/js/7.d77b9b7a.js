(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{193:function(e,t,n){"use strict";n.r(t);var a=n(2),s=function(e){e.options.__data__block__={mermaid_64a570a4:'%%{init: {\'theme\':\'base\', "securityLevel": "loose"}}%%\n\nclassDiagram\n    UserAgent -- UserAgentOptions\n    UserAgent "0" --\x3e "*" Session\n    UserAgent *.. MessageParser\n    UserAgent *.. MediaHandler\n    class UserAgent{\n        +MediaHandler mediaHandler\n        ~WeakMap~Session~ sessions\n        ~boolean connected\n        \n        +constructor(options: UserAgentOptions)\n\n        +connect()\n        +disconnect()\n        +isConnected()\n        \n        -onSession(peerConnection)\n    }\n    class MediaHandler{\n        ~boolean isMuted\n        ~boolean isHeld\n        ~boolean inCall\n        ~MediaStream localMediaStream\n        ~MediaStream remoteMediaStream\n\n        +answer()\n        +hangup()\n        +hold()\n        +unhold()\n        +isHeld()\n        +mute()\n        +unMute()\n        +isMuted()\n        +sendDTMF(tone: string)\n        +message(message: string, destination: string)\n        \n        +localMediaStream()\n        +remoteMediaStream()\n    }\n    class UserAgentOptions{\n        <<Interface>>\n        username: string\n        delegate: UserAgentDelegate\n        url?: string\n        password?: string\n    }\n    UserAgentOptions <-- UserAgentDelegate\n    class UserAgentDelegate{\n        <<Interface>>\n    }\n    class Session{\n        <<Abstract>>\n        ~WeakMap~AbstractMessage~ messages\n    }\n    Session <-- AbstractMessage\n    class AbstractMessage{\n        <<Abstract>>\n        ~number sequence\n    }\n    class MessageParser{\n        <<Interface>>\n        +Message parse(str)\n    }\n',mermaid_64a57066:"%%{init: {'theme':'base', \"securityLevel\": \"loose\"}}%%\n\nclassDiagram\n    class MessageEvent{\n        <<enumeration>>\n        Ack\n        Bye\n        Cancel\n        Info\n        Invite\n        Message\n        Notify\n        Refer\n        Update\n    }\n",mermaid_64a5701e:"%%{init: {'theme':'base', \"securityLevel\": \"loose\"}}%%\n\nclassDiagram\n    class Identity{\n        -String uri\n        \n        +friendlyName()\n        +raw()\n    }\n    Session o-- Identity\n    class Session {\n        <<Abstract>>\n        +Array~String~ data\n        -String contact\n        +remoteIdentity() Identity\n        +localIdentity() Identity\n    }\n",mermaid_64a56fec:"%%{init: {'theme':'base', \"securityLevel\": \"loose\"}}%%\n\nstateDiagram-v2\n    [*] --\x3e Standby\n    Standby --\x3e Bye\n    Standby --\x3e Invite\n\n    Invite --\x3e Ack\n    Ack --\x3e Negotiation\n    Negotiation --\x3e Bye\n    Bye --\x3e Standby\n    Bye --\x3e [*]\n",mermaid_64a5682a:"%%{init: {'theme':'base', \"securityLevel\": \"loose\"}}%%\n\n sequenceDiagram\n    Note over Alice,Bob: without Authorization header\n    Alice->>Bob: REGISTER\n    Bob--\x3e>Alice: 401\n    Note over Alice,Bob: with Authorization header\n    Alice->>Bob: REGISTER\n    Bob--\x3e>Alice: 200\n",mermaid_64a567ec:"%%{init: {'theme':'base', \"securityLevel\": \"loose\"}}%%\n\nsequenceDiagram\n    participant A as Alice\n    participant B as Bob\n    A->>+B: INVITE\n    Note left of A: CSeq: 2 Invite<br/>Username: 'Alice'<br/>Nonce Value: '***'<br/>Authentication URI: 'sip:user@192.168.10.20'\n    B--\x3e>-A: 100 Trying\n    Note right of B: CSeq: 2 Invite\n    B--\x3e>A: 183 Session Progress\n    Note right of B: Authenticate against the Nonce challenge.<br/>Allocate UDP port for RTP traffic\n    Note right of B: CSeq 2: Invite<br/>c: IN IP4 192.168.10.20<br/>a: rtpmap:0 PCMU/8000<br/>a: rtpmap:101 telephone-event/8000<br/>a: fmtp: 101 0-11<br/>a: ptime:20<br/>a: setup:active<br/>a: sendrecv\n    Note left of A: Ringing\n    B--\x3e>A: 200 OK\n    Note left of A: Answer\n    A->>B: ACK\n",mermaid_64a56778:"%%{init: {'theme':'base', \"securityLevel\": \"loose\"}}%%\n\nsequenceDiagram\n    Alice--\x3eBob: INVITE\n    Alice--\x3eBob: 183 Session Progress\n    Alice->>+Bob: 100 Trying\n    note right of Bob: Ringing\n    Bob--\x3e>-Alice: ACK\n    Bob--\x3e>John: Want to join the meeting?\n    Bob-x John: Sure\n    Bob--\x3eAlice: Please Invite John\n    Alice->>+John: INVITE\n    note right of John: (183 & 100)\n    John->>-Alice: ACK\n    Note left of Alice: Conference started\n",mermaid_64a56728:'%%{init: {\'theme\':\'base\', "securityLevel": "loose"}}%%\n\ngraph TD\n    Transfer --\x3e Type{Type}\n    Type     --\x3e Blind\n    Type     --\x3e Attended\n    Blind    --\x3e Refer\n    Refer    --\x3e |"Alice hangs up"|Hangup\n    Attended --\x3e |"sip:bob@192.168.20.20"|Invite\n    Invite   --\x3e |"Bob answers"|Answer\n    Answer   --\x3e Refer\n'}},r=Object(a.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"table-of-contents"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#table-of-contents"}},[e._v("#")]),e._v(" Table of Contents")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#sip"}},[e._v("SIP")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#useragent"}},[e._v("UserAgent")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#useragentdelegate"}},[e._v("UserAgentDelegate")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#useragentdelegate---eksempel"}},[e._v("UserAgentDelegate - Eksempel")])])])]),e._v(" "),n("li",[n("a",{attrs:{href:"#session"}},[e._v("Session")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#abstractmessage"}},[e._v("AbstractMessage")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#indregistrering"}},[e._v("Indregistrering")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#opkald"}},[e._v("Opkald")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#konference"}},[e._v("Konference")])])])]),e._v(" "),n("li",[n("a",{attrs:{href:"#viderestilling"}},[e._v("Viderestilling")]),e._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"#blind"}},[e._v("Blind")])]),e._v(" "),n("li",[n("a",{attrs:{href:"#attended"}},[e._v("Attended")])])])])]),e._v(" "),n("p",[e._v("Når man skal facilitere et VOIP "),n("strong",[e._v("(Voice Over IP)")]),e._v(" opkald forgår det\ntypisk via SIP "),n("strong",[e._v("(Session Initiation Protocol)")]),e._v(" som er en\nsignaleringsprotokol, også kendt som application-layer control. SIP\nbruger flere transport protokoller som TCP, UDP, SCTCP, RSVP m.fl.")]),e._v(" "),n("p",[e._v("En SIP User Agent har til opgave at oprette, modificere og afslutte\nsessioner. Disse sessioner inkluderer IP Telefoni, multimedie\ndistribution og multimedie konferencer.")]),e._v(" "),n("p",[e._v("En user agent vil typisk forbinde til en dedikeret server, der kan\nhåndtere transcoding af mediet. Men da standarden også tillader to\nklienter at snakke sammen, dvs. at de både agere klient og server, vil\nløsningen fokusere på dette scenarie for at simplificere projektet.")]),e._v(" "),n("p",[e._v("Teoretisk tillader dette også langt højere kvalitet, da en typisk\ntelefonsamtale har 64 kbit til rådighed "),n("em",[e._v("(PCMA/G.711)")]),e._v(".")]),e._v(" "),n("p",[e._v("Når de to klienter vil oprette forbindelse mellem hinanden, kommunikere\nde hvilke funktionaliteter de understøtter (voice, video). Samt codecs\nog bitrates.")]),e._v(" "),n("p",[e._v("For at starte et opkald vil den ene sende en "),n("strong",[e._v("Invite")]),e._v(" besked til den\nanden, med disse informationer. Når den modsatte part acceptere, skal\nklienterne blive enige om hvordan de kommunikere.")]),e._v(" "),n("p",[e._v("Dette foregår via princippet at højeste fællesnævner bestemmer.")]),e._v(" "),n("h2",{attrs:{id:"sip"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sip"}},[e._v("#")]),e._v(" SIP")]),e._v(" "),n("p",[e._v("SIP er en plain text protokol. I eksemplet herunder, er vist en\n"),n("strong",[e._v("REGISTER")]),e._v(" pakke. Her er også implementeret authorization og\nkommunikationen er over WebSocket med TLS.")]),e._v(" "),n("div",{staticClass:"language-http request extra-class"},[n("pre",{pre:!0,attrs:{class:"language-http"}},[n("code",[e._v("REGISTER sip:remotehost SIP/2.0\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[e._v("Via:")]),e._v(" SIP/2.0/WSS 3af6pj3a8fk4.invalid;branch=z9hG4bK4997110\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[e._v("Max-Forwards:")]),e._v(" 69\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[e._v("To:")]),e._v(" <sip:bob@192.168.20.20>\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[e._v("From:")]),e._v(" <sip:alice@192.168.20.19>;tag=itp46o81e5\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[e._v("Call-ID:")]),e._v(" Alice\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[e._v("CSeq:")]),e._v(" 2 REGISTER\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[e._v("Authorization:")]),e._v(" Digest algorithm=MD5, ...\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[e._v("Contact:")]),e._v(" <sip:alice@192.168.20.19;transport=ws>;...;expires=600\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[e._v("Expires:")]),e._v(" 600\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[e._v("Allow:")]),e._v(" INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO,NOTIFY\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[e._v("Supported:")]),e._v(" path,gruu,outbound\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[e._v("User-Agent:")]),e._v(" sip-ua\n"),n("span",{pre:!0,attrs:{class:"token header-name keyword"}},[e._v("Content-Length:")]),e._v(" 0\n")])])]),n("p",[e._v("Meget af den viden man har fra HTTP 1.1 kan man genbruge i SIP land.\n"),n("strong",[e._v("Allow")]),e._v(" kan f.eks. sammenlignes med med CORS headeren\n"),n("strong",[e._v("Access-Control-Allow-Methods")]),e._v(".")]),e._v(" "),n("p",[e._v("Det specielle ved SIP er at alle beskeder indeholder en "),n("strong",[e._v("CSeq")]),e._v(" header\nmed en metode og et sekvens id angivet i "),n("code",[e._v("integer")]),e._v(". Protokollen tillader\nnemlig "),n("em",[e._v("Out of Order")]),e._v(" pakker. En user agent og tilsvarende server,\n"),n("strong",[e._v("SKAL")]),e._v(" understøtte dette, da man ellers har en ødelagt implementation.\nVigtigst er at man inkrementere id´et med n+1. Man starter typisk fra\n"),n("strong",[e._v("1")]),e._v(", men dette er ikke så vigtigt.")]),e._v(" "),n("h2",{attrs:{id:"useragent"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#useragent"}},[e._v("#")]),e._v(" UserAgent")]),e._v(" "),n("p",[e._v("En bruger af dette user agent bibliotek vil blive eksponeret overfor en\n"),n("code",[e._v("UserAgent")]),e._v(" klasse, der under alle omstændigheder skal anvendes som\n"),n("code",[e._v("Singleton")]),e._v(". Grunden til dette er, at det for det første ikke giver\nmening at have flere "),n("em",[e._v('"telefoner"')]),e._v(" i et browser vindue. Men også fordi i\ntilfælde af flere opkald, vil det blive alt for uoverskueligt at\nprogrammere routingen af opkald.")]),e._v(" "),n("p",[e._v("I disse tilfælde skal man bruge en PBX server, hvor man konfigurere\nrouting tabeller. Men dette er ude af scopet for dette projekt. Dog vil\njeg henvise til "),n("a",{attrs:{href:"https://www.asterisk.org/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Asterisk"),n("OutboundLink")],1),e._v(" skulle det blive\naktuelt.")]),e._v(" "),n("Mermaid",{attrs:{id:"mermaid_64a570a4",graph:e.$dataBlock.mermaid_64a570a4}}),n("p",[e._v("En factory funktion ville her være fordelagtigt til instantiering af\n"),n("code",[e._v("UserAgent")]),e._v(". Denne kan så bindes til en dependency container.")]),e._v(" "),n("h3",{attrs:{id:"useragentdelegate"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#useragentdelegate"}},[e._v("#")]),e._v(" UserAgentDelegate")]),e._v(" "),n("p",[e._v("Et interface til at binde callbacks til UserAgent events. Disse\ncallbacks er metoderne til at, binde ens brugerflade til klienten - og\nderved kan gøre brugerfladen "),n("em",[e._v("reaktionær")]),e._v(".")]),e._v(" "),n("Mermaid",{attrs:{id:"mermaid_64a57066",graph:e.$dataBlock.mermaid_64a57066}}),n("div",{staticClass:"language-typescript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("interface")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Identity")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Call ID header or parsed from 'From'|'To'")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// depending on if our side is receiver or sender.")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("friendlyName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// raw header")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("raw")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("interface")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Invite")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  sender"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" Identity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  withoutSdp"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("boolean")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("interface")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("UserAgentDelegate")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("onMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("message"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" sender"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" Identity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Return true to accept or false to decline")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("onInvite")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("invite"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" Invite"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("Promise")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("boolean")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Called when someone refers a call to us.")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("onRefer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("referer"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" Identity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" referral"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" Identity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("Promise")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("boolean")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Allows for hooking into messages.")]),e._v("\n  onEvent"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("?")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("event"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" MessageEvent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Called when user makes a call.")]),e._v("\n  onCallCreated"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("?")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Called when user is registered to received calls.")]),e._v("\n  onRegistered"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("?")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Called when user is no longer registered to received calls.")]),e._v("\n  onUnregistered"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("?")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Called when user is connected to server.")]),e._v("\n  onServerConnect"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("?")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Called when user is no longer connected.")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// @param error - An Error if server caused the disconnect. Otherwise undefined.")]),e._v("\n  onServerDisconnect"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("?")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("error"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("?")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" Error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),n("h3",{attrs:{id:"useragentdelegate-eksempel"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#useragentdelegate-eksempel"}},[e._v("#")]),e._v(" UserAgentDelegate - Eksempel")]),e._v(" "),n("div",{staticClass:"language-typescript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-typescript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" delegate"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" UserAgentDelegate "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("onMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("message"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" sender"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" Identity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("console")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("Received message from: ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("${")]),e._v("sender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("friendlyName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("async")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("onInvite")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("invite"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" Invite"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("console")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("Received invite from ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("${")]),e._v("invite"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("sender"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("friendlyName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// accept")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("async")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("onRefer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("referer"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" Identity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" referral"),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" Identity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[e._v("console")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n      "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[e._v("Received refer from ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("${")]),e._v("referer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("friendlyName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[e._v(" to ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("${")]),e._v("referral"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[e._v("friendlyName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[e._v("}")])]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[e._v("`")])]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// accept")]),e._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("const")]),e._v(" ua "),n("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("UserAgent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" username"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" password"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" delegate "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),n("h2",{attrs:{id:"session"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#session"}},[e._v("#")]),e._v(" Session")]),e._v(" "),n("p",[e._v("En UserAgent kan have flere opkald igang. Derfor er sessions gemt på\n"),n("code",[e._v("UserAgent")]),e._v(" som et WeakMap.")]),e._v(" "),n("p",[e._v("I tilfælde af flere opkald, vil det aktive opkald være dét som brugeren\ner forbundet til. De andre vil være på "),n("code",[e._v("Hold")]),e._v(".")]),e._v(" "),n("Mermaid",{attrs:{id:"mermaid_64a5701e",graph:e.$dataBlock.mermaid_64a5701e}}),n("p",[e._v("En session afvikles typisk således:")]),e._v(" "),n("Mermaid",{attrs:{id:"mermaid_64a56fec",graph:e.$dataBlock.mermaid_64a56fec}}),n("h2",{attrs:{id:"abstractmessage"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#abstractmessage"}},[e._v("#")]),e._v(" AbstractMessage")]),e._v(" "),n("p",[e._v("Message pakker skal du som regel ikke bruge i praksis. Da\n"),n("a",{attrs:{href:"#useragentdelegate"}},[e._v("UserAgentDelegate")]),e._v(", vil dække 99% use-cases. Dog er\ndet muligt at hooke ind i dem. F.eks. hvis du skal implementere instant\nchat.")]),e._v(" "),n("p",[e._v("De konkrete klasser er listet her:")]),e._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"left"}},[e._v("Navn")]),e._v(" "),n("th",{staticStyle:{"text-align":"left"}},[e._v("Beskrivelse")])])]),e._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"left"}},[e._v("Ack")]),e._v(" "),n("td",{staticStyle:{"text-align":"left"}},[e._v("Acknowledge")])]),e._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[e._v("Bye")]),e._v(" "),n("td",{staticStyle:{"text-align":"left"}},[e._v("Afsluttet opkald")])]),e._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[e._v("Cancel")]),e._v(" "),n("td",{staticStyle:{"text-align":"left"}},[e._v("Afbryd opkald")])]),e._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[e._v("Info")]),e._v(" "),n("td",{staticStyle:{"text-align":"left"}},[e._v("Applikations nieaveu information. Normalvis relateret til en session.")])]),e._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[e._v("Invite")]),e._v(" "),n("td",{staticStyle:{"text-align":"left"}},[e._v("Indgående opkald")])]),e._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[e._v("Message")]),e._v(" "),n("td",{staticStyle:{"text-align":"left"}},[e._v("Indgående Tekst besked")])]),e._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[e._v("Notify")]),e._v(" "),n("td",{staticStyle:{"text-align":"left"}},[e._v("Ændring af session")])]),e._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[e._v("Refer")]),e._v(" "),n("td",{staticStyle:{"text-align":"left"}},[e._v("Omstilling")])]),e._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"left"}},[e._v("Update")]),e._v(" "),n("td",{staticStyle:{"text-align":"left"}},[e._v("Ændring af medie stream")])])])]),e._v(" "),n("h2",{attrs:{id:"indregistrering"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#indregistrering"}},[e._v("#")]),e._v(" Indregistrering")]),e._v(" "),n("p",[e._v("Biblioteket bruger en pinkode som kodeord, når "),n("em",[e._v("Alice")]),e._v(" vil snakke med\n"),n("em",[e._v("Bob")]),e._v(", uden en server i mellem. Aftaler hun at bruge koden "),n("strong",[e._v("1234")]),e._v(" som\n"),n("code",[e._v("password")]),e._v(".")]),e._v(" "),n("p",[e._v("En SIP "),n("code",[e._v("REGISTER")]),e._v(" "),n("strong",[e._v("SKAL")]),e._v(" altid først sendes uden password. Når den\nbliver afvist med status "),n("strong",[e._v("401")]),e._v(", så aftaler klienterne en "),n("code",[e._v("nonce")]),e._v(" - som\nbliver inkluderet i næste "),n("code",[e._v("REGISTER")]),e._v(" forsøg. Inklusiv kodeordet.")]),e._v(" "),n("p",[n("code",[e._v("nonce")]),e._v(" bliver genereret af "),n("em",[e._v("Bob")]),e._v(" og sendt til "),n("em",[e._v("Alice")]),e._v(". Dette er en\n"),n("code",[e._v("Password-Challenge")]),e._v(" Når "),n("em",[e._v("Alice")]),e._v(" så indregistrere igen, så ved "),n("em",[e._v("Bob")]),e._v(" at,\ndet er samme "),n("em",[e._v("Alice")]),e._v(" han snakker med - da kun hun vil kende til den\nværdi.")]),e._v(" "),n("p",[e._v("Den underlæggende implementation er håndteret af biblioteket. Som bruger\nvil dette være gemt under abstraktionen, men det vil dog være en fordel\nat have en forståelse af hvordan dette fungerer. Specielt i debug\ntilfælde.")]),e._v(" "),n("Mermaid",{attrs:{id:"mermaid_64a5682a",graph:e.$dataBlock.mermaid_64a5682a}}),n("p",[n("a",{attrs:{href:"#useragentdelegate"}},[e._v("UserAgentDelegate")])]),e._v(" "),n("p",[n("code",[e._v("UserAgentDelegate::onRegistered")])]),e._v(" "),n("h2",{attrs:{id:"opkald"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#opkald"}},[e._v("#")]),e._v(" Opkald")]),e._v(" "),n("Mermaid",{attrs:{id:"mermaid_64a567ec",graph:e.$dataBlock.mermaid_64a567ec}}),n("p",[n("a",{attrs:{href:"#useragentdelegate"}},[e._v("UserAgentDelegate")])]),e._v(" "),n("p",[n("strong",[e._v("Alice")]),e._v(" "),n("code",[e._v("UserAgentDelegate::onCallCreated")])]),e._v(" "),n("p",[n("strong",[e._v("Bob")]),e._v(" "),n("code",[e._v("UserAgentDelegate::onInvite")])]),e._v(" "),n("h3",{attrs:{id:"konference"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#konference"}},[e._v("#")]),e._v(" Konference")]),e._v(" "),n("p",[e._v("Et konference kald vil se ud således:")]),e._v(" "),n("Mermaid",{attrs:{id:"mermaid_64a56778",graph:e.$dataBlock.mermaid_64a56778}}),n("h2",{attrs:{id:"viderestilling"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#viderestilling"}},[e._v("#")]),e._v(" Viderestilling")]),e._v(" "),n("p",[e._v("Når man viderestiller et opkald, er der 2 måder at gøre det på.")]),e._v(" "),n("h3",{attrs:{id:"blind"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#blind"}},[e._v("#")]),e._v(" Blind")]),e._v(" "),n("p",[e._v("Ved en blind omstilling, tjekker man ikke om modparten rent faktisk er\nklar til at modtage opkaldet. Derimod så sender man bare opkaldet\nvidere, og så bliver der lagt på.")]),e._v(" "),n("h3",{attrs:{id:"attended"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#attended"}},[e._v("#")]),e._v(" Attended")]),e._v(" "),n("p",[e._v("Ved en Attended omstilling, ringer man modparten op og venter på svar.\nHer kan man snakke sammen, og forklare hvorfor man omstiller - uden at\npersonen der skal omstilles kan gøre med. Derved slipper en eventuel\nkunde for, at beskrive sit problem igen.")]),e._v(" "),n("Mermaid",{attrs:{id:"mermaid_64a56728",graph:e.$dataBlock.mermaid_64a56728}}),n("p",[n("a",{attrs:{href:"#useragentdelegate"}},[e._v("UserAgentDelegate")])]),e._v(" "),n("p",[n("strong",[e._v("Alice")]),e._v(" "),n("code",[e._v("UserAgentDelegate::onCallCreated")])]),e._v(" "),n("p",[n("strong",[e._v("Bob")]),e._v(" "),n("code",[e._v("UserAgentDelegate::onRefer")])])],1)}),[],!1,null,null,null);"function"==typeof s&&s(r);t.default=r.exports}}]);